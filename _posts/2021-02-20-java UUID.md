---
layout:     post
title:      java UUID
subtitle:   java中UUID操作
categories: [Java初级进阶]
mermaid: false
sequence: false
flow: false
mathjax: false
mindmap: false
mindmap2: false
---

# 1. java生成UUID。有什么通用的类吗？
在Java中生成UUID（Universally Unique Identifier）可以使用Java标准库中的`java.util.UUID`类。这个类提供了静态方法来生成不同版本（Version 1、Version 3、Version 4、Version 5）的UUID。通常情况下，我们使用Version 4的UUID，因为它是基于随机数生成的，足够满足大多数场景的唯一性需求。

以下是生成Version 4 UUID的示例代码：

```java
import java.util.UUID;

public class Main {
    public static void main(String[] args) {
        // 生成Version 4的UUID
        UUID uuid = UUID.randomUUID();
        System.out.println("Generated UUID: " + uuid.toString());
    }
}
```

在这段代码中，`UUID.randomUUID()`方法会返回一个新的随机生成的Version 4 UUID，并将其打印出来。

需要注意的是，UUID是128位的数字，通常以32个字符的形式表示（包括4个短划线），例如："550e8400-e29b-41d4-a716-446655440000"。每次调用`UUID.randomUUID()`都会生成一个新的UUID，因此它具有很高的唯一性。

# 2. 如何去除-呢？
要去除UUID中的短划线（-），可以使用`UUID`类的`toString`方法得到UUID的字符串表示，然后使用`replaceAll`方法去除短划线。下面是一个示例代码：

```java
import java.util.UUID;

public class Main {
    public static void main(String[] args) {
        // 生成Version 4的UUID
        UUID uuid = UUID.randomUUID();
        
        // 去除短划线
        String uuidWithoutHyphens = uuid.toString().replaceAll("-", "");
        
        System.out.println("UUID with hyphens: " + uuid.toString());
        System.out.println("UUID without hyphens: " + uuidWithoutHyphens);
    }
}
```

在这个示例中，`replaceAll("-","")`会将UUID字符串中的短划线全部替换为空字符串，从而得到没有短划线的UUID字符串。

需要注意的是，UUID本身是一个128位的数字，去除短划线后得到的字符串长度会变为32个字符。

# 3. 详细列举java中生成UUID的所有方式
在Java中生成UUID主要通过`java.util.UUID`类实现。UUID类支持生成和操作多种版本的UUID。下面详细列举了Java中生成UUID的所有常见方式及其不同版本的特性：

### 1. 使用 `UUID.randomUUID()` 生成 Version 4 UUID

这是最常用的生成UUID的方式，基于随机数生成UUID。Version 4 UUID使用随机数生成128位的标识符，保证了极高的唯一性。

```java
import java.util.UUID;

public class Main {
    public static void main(String[] args) {
        UUID uuid = UUID.randomUUID(); // Version 4 UUID
        System.out.println("Version 4 UUID: " + uuid);
    }
}
```

**特点**:
- 基于随机数
- 唯一性非常高，适用于大多数场景
- 生成速度快

### 2. 使用 `UUID.nameUUIDFromBytes()` 生成 Version 3 或 Version 5 UUID

`UUID.nameUUIDFromBytes(byte[] name)`可以根据命名空间生成UUID。UUID的版本由哈希函数决定：
- **Version 3 UUID** 是基于MD5哈希生成的。
- **Version 5 UUID** 是基于SHA-1哈希生成的。

```java
import java.util.UUID;

public class Main {
    public static void main(String[] args) {
        // 使用字节数组生成基于命名空间的UUID (Version 3)
        byte[] name = "example.com".getBytes();
        UUID uuidV3 = UUID.nameUUIDFromBytes(name); // Version 3 (MD5)
        System.out.println("Version 3 UUID: " + uuidV3);
    }
}
```

**特点**:
- 基于命名空间和输入的数据生成
- 生成相同输入时返回相同的UUID（确定性）
- Version 3使用MD5哈希；Version 5使用SHA-1哈希

### 3. 通过 `UUID.fromString()` 方法创建UUID

`UUID.fromString(String uuid)`可以从一个合法的UUID字符串创建UUID对象。此方法不生成新的UUID，而是解析现有的UUID字符串。

```java
import java.util.UUID;

public class Main {
    public static void main(String[] args) {
        String uuidStr = "550e8400-e29b-41d4-a716-446655440000";
        UUID uuid = UUID.fromString(uuidStr);
        System.out.println("UUID from string: " + uuid);
    }
}
```

**特点**:
- 适用于将已有的UUID字符串转换为UUID对象

### 4. 自定义基于时间的UUID (Version 1) - Java 不提供直接API

Java标准库中没有直接提供生成Version 1（基于时间的UUID）的API，但可以通过第三方库（如Apache Commons Id、UUID Generator等）来生成Version 1 UUID。

如果一定要使用Version 1 UUID，可以使用类似如下的第三方库：
```xml
<!-- Maven依赖 -->
<dependency>
    <groupId>com.fasterxml.uuid</groupId>
    <artifactId>java-uuid-generator</artifactId>
    <version>4.0.1</version>
</dependency>
```

然后通过如下代码生成Version 1 UUID：
```java
import com.fasterxml.uuid.Generators;
import com.fasterxml.uuid.impl.TimeBasedGenerator;

public class Main {
    public static void main(String[] args) {
        TimeBasedGenerator uuidGenerator = Generators.timeBasedGenerator();
        UUID uuidV1 = uuidGenerator.generate();
        System.out.println("Version 1 UUID: " + uuidV1);
    }
}
```

**特点**:
- 基于时间戳生成UUID（使用当前时间）
- 包含物理网络地址（MAC地址），适合分布式系统唯一性要求较高的场景

### 5. 使用第三方库生成不同版本UUID

除了Java标准库，您还可以使用第三方库来生成不同版本的UUID，比如`Apache Commons Id`、`JUG (Java UUID Generator)`等。

#### 使用 Apache Commons Id

```xml
<!-- Maven依赖 -->
<dependency>
    <groupId>commons-id</groupId>
    <artifactId>commons-id</artifactId>
    <version>0.1</version>
</dependency>
```

示例代码：
```java
import org.apache.commons.id.uuid.UUID;

public class Main {
    public static void main(String[] args) {
        UUID uuidV1 = UUID.timeUUID(); // Version 1
        System.out.println("Apache Commons Version 1 UUID: " + uuidV1);
    }
}
```

#### 使用 Java UUID Generator (JUG)
```xml
<!-- Maven依赖 -->
<dependency>
    <groupId>com.fasterxml.uuid</groupId>
    <artifactId>java-uuid-generator</artifactId>
    <version>4.0.1</version>
</dependency>
```

### 6. 自定义 UUID

你还可以自定义生成UUID的规则。例如，在基于某些算法或应用程序逻辑的场景中创建UUID（这种情况下，你不依赖于UUID类，而是创建自己的生成规则）。

---

### 总结

Java中的UUID生成方式主要有以下几种：
1. **Version 4 UUID** - 使用 `UUID.randomUUID()` 基于随机数生成。
2. **Version 3/5 UUID** - 使用 `UUID.nameUUIDFromBytes(byte[] name)` 基于命名空间和MD5或SHA-1哈希生成。
3. **从字符串生成UUID** - 使用 `UUID.fromString(String uuid)`。
4. **Version 1 UUID** - 通过第三方库（如`JUG`或`Apache Commons Id`）生成基于时间戳的UUID。

通常，Java原生的 `UUID.randomUUID()`（Version 4）生成方式最常用，因为它生成的UUID足够唯一且不需要额外的依赖。

# 4. uuid一定唯一吗？
UUID（Universally Unique Identifier）是一种全局唯一标识符，通常用于标识信息或对象。UUID 的标准定义确保了在一定条件下生成的 UUID 是唯一的，但并不是绝对的唯一。

UUID 的唯一性基于以下几点：

1. **标准定义：** 标准的 UUID 版本（如 UUIDv1、UUIDv4）会结合时间戳、MAC 地址、随机数等因素生成 UUID，从而保证在一定概率下生成的 UUID 是唯一的。

2. **算法保证：** UUID 的生成算法会考虑当前时间、节点信息、随机数等因素，确保生成的 UUID 在同一时空范围内不会重复。

尽管 UUID 在理论上是唯一的，但在实际应用中仍有一些需要注意的情况：

- **碰撞概率：** 虽然 UUID 的碰撞概率非常低，但仍然存在极小的可能性。特别是在短时间内生成大量 UUID 时，碰撞的风险可能会增加。

- **随机性：** 随机生成的 UUID 在同一时刻可能会出现相同的值，尤其是在使用 UUIDv4 时，因为其部分内容是基于随机数生成的。

因此，在使用 UUID 时，应该根据具体情况评估其唯一性的要求，以及可能存在的碰撞风险。对于绝对唯一性要求极高的场景，可能需要额外的措施来确保唯一性，例如使用数据库的唯一索引或者其他业务逻辑来检查。

# 5. 如何避免uuid重复呢？
要避免 UUID 重复，可以考虑以下几种方法：

1. **使用不同版本的UUID：** UUID 有不同的版本（如 UUIDv1、UUIDv4），每个版本生成 UUID 的方式不同。可以根据具体需求选择合适的版本，以降低重复的可能性。

2. **使用数据库唯一索引：** 在数据库中存储 UUID 时，可以为 UUID 列添加唯一索引，确保数据库中的 UUID 值不重复。

3. **限制生成频率：** 在生成 UUID 的过程中，可以限制生成的频率，避免在短时间内生成大量 UUID，从而减少碰撞的可能性。

4. **结合其他信息生成UUID：** 可以在生成 UUID 的过程中，结合其他信息（如时间戳、节点信息等）生成 UUID，增加唯一性的保证。

5. **持久化已使用的UUID：** 可以将已经使用过的 UUID 记录下来，避免再次使用相同的 UUID。

6. **定期检查和清理：** 定期检查系统中已经使用的 UUID，及时清理不再需要的 UUID，避免重复使用。

组合使用以上方法可以有效地降低 UUID 重复的可能性。根据具体情况，可以选择其中一种或多种方法来保证 UUID 的唯一性。

# 6. HUTOOL返回uuid自动去除_？
在 Hutool 中，生成 UUID 默认是带有横线的，如果你想生成一个没有横线的 UUID，你可以使用 `IdUtil.fastUUID()` 方法，然后通过 `.replace("-", "")` 去掉横线，或者直接使用 `IdUtil.fastSimpleUUID()`，它会自动返回一个不带横线的 UUID。

具体代码如下：

```java
// 使用 fastUUID 生成带横线的 UUID，然后手动去除横线
String uuidWithHyphen = IdUtil.fastUUID();
String uuidWithoutHyphen = uuidWithHyphen.replace("-", "");
System.out.println(uuidWithoutHyphen);

// 使用 fastSimpleUUID 直接生成不带横线的 UUID
String simpleUUID = IdUtil.fastSimpleUUID();
System.out.println(simpleUUID);
```

这样你就可以生成不带横线的 UUID 了。

