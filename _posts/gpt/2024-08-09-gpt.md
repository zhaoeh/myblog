---
layout:     post
title:      TransmittableThreadLocal Overview
subtitle:   TransmittableThreadLocal Overview
categories: [gpt]
mermaid: false
sequence: false
flow: false
mathjax: false
mindmap: false
mindmap2: false
---

# 1. TransmittableThreadLocalæ˜¯ä»€ä¹ˆï¼Ÿä¸ä¹‹ç±»ä¼¼çš„è¿˜æœ‰å“ªäº›ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆåŠŸèƒ½å’Œä½œç”¨ï¼Ÿ
`TransmittableThreadLocal` æ˜¯ä¸€ä¸ªçº¿ç¨‹å±€éƒ¨å˜é‡çš„å®ç°ï¼Œä¸»è¦ç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨çº¿ç¨‹æ± ç­‰å¹¶å‘æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä¼ é€’çº¿ç¨‹æœ¬åœ°å˜é‡çš„å€¼ã€‚å®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯èƒ½å¤Ÿåœ¨è·¨çº¿ç¨‹ä¼ é€’ `ThreadLocal` ä¸­çš„å€¼ï¼Œè§£å†³äº†ä¼ ç»Ÿ `ThreadLocal` åœ¨å¤šçº¿ç¨‹æ“ä½œä¸­æ— æ³•ä¼ é€’å±€éƒ¨å˜é‡çš„å€¼çš„é—®é¢˜ã€‚

### åŠŸèƒ½ä¸ä½œç”¨ï¼š

1. **ä¼ é€’çº¿ç¨‹å±€éƒ¨å˜é‡**ï¼š
   `TransmittableThreadLocal` å…è®¸åœ¨å­çº¿ç¨‹ä¸­è®¿é—®çˆ¶çº¿ç¨‹çš„ `ThreadLocal` å˜é‡ã€‚è¿™å¯¹äºåœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ä¿æŒçº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼ç‰¹åˆ«æœ‰ç”¨ã€‚

2. **è·¨çº¿ç¨‹ä¼ é€’ä¸Šä¸‹æ–‡**ï¼š
   åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ`TransmittableThreadLocal` å¯ä»¥ç”¨æ¥ä¼ é€’è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ã€äº‹åŠ¡ä¿¡æ¯ç­‰ï¼Œä»ä¸€ä¸ªçº¿ç¨‹åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ã€‚

### ä¸ä¹‹ç±»ä¼¼çš„å®ç°ï¼š

1. **`ThreadLocal`**ï¼š
   - **åŠŸèƒ½**ï¼šåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­ç»´æŠ¤ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œç¡®ä¿çº¿ç¨‹ä¹‹é—´çš„å˜é‡ä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚
   - **ä½œç”¨**ï¼šç”¨äºå­˜å‚¨çº¿ç¨‹å±€éƒ¨æ•°æ®ï¼Œä½†æ— æ³•åœ¨è·¨çº¿ç¨‹çš„åœºæ™¯ä¸­ä¼ é€’è¿™äº›æ•°æ®ã€‚

2. **`InheritableThreadLocal`**ï¼š
   - **åŠŸèƒ½**ï¼šå­çº¿ç¨‹å¯ä»¥ç»§æ‰¿çˆ¶çº¿ç¨‹ä¸­çš„ `ThreadLocal` å˜é‡å€¼ã€‚
   - **ä½œç”¨**ï¼šåœ¨çˆ¶çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹æ—¶ï¼Œå­çº¿ç¨‹å¯ä»¥ç»§æ‰¿çˆ¶çº¿ç¨‹çš„ `ThreadLocal` å˜é‡çš„å€¼ï¼Œä½†æ— æ³•åœ¨ä½¿ç”¨çº¿ç¨‹æ± ç­‰æƒ…å†µä¸‹è·¨çº¿ç¨‹ä¼ é€’å€¼ã€‚

3. **`Contextual` (ä¾‹å¦‚ï¼Œ`Brave` çš„ `ThreadContext`)**ï¼š
   - **åŠŸèƒ½**ï¼šç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚
   - **ä½œç”¨**ï¼šæä¾›äº†åœ¨ä¸åŒçš„æœåŠ¡é—´ä¼ é€’ä¸Šä¸‹æ–‡çš„æœºåˆ¶ï¼Œå¦‚é“¾è·¯è¿½è¸ªä¸­çš„ä¸Šä¸‹æ–‡ä¼ é€’ã€‚

4. **`MDC` (Mapped Diagnostic Context)**ï¼š
   - **åŠŸèƒ½**ï¼šåœ¨æ—¥å¿—è®°å½•ä¸­ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ· IDã€è¯·æ±‚ ID ç­‰ã€‚
   - **ä½œç”¨**ï¼šåœ¨æ—¥å¿—è®°å½•ä¸­æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¸®åŠ©è¿›è¡Œè°ƒè¯•å’Œè¿½è¸ªã€‚

### æ€»ç»“ï¼š

- `TransmittableThreadLocal` ä¸»è¦è§£å†³çº¿ç¨‹æ± ç­‰åœºæ™¯ä¸‹çº¿ç¨‹å±€éƒ¨å˜é‡ä¼ é€’çš„é—®é¢˜ã€‚
- `ThreadLocal` å’Œ `InheritableThreadLocal` æä¾›äº†ä¼ ç»Ÿçš„çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼Œä½†ä¸èƒ½åœ¨è·¨çº¿ç¨‹åœºæ™¯ä¸­ä¼ é€’ã€‚
- `Contextual` å’Œ `MDC` æä¾›äº†ä¸åŒåœºæ™¯ä¸‹çš„ä¸Šä¸‹æ–‡ä¼ é€’å’Œè®°å½•åŠŸèƒ½ã€‚

é€‰æ‹©åˆé€‚çš„å®ç°å–å†³äºå…·ä½“çš„ä½¿ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚

# 2. InheritableThreadLocalèƒ½ç¡®ä¿å§‹ç»ˆå¯ä»¥ä¼ é€’çˆ¶çº¿ç¨‹çš„å€¼å—ï¼Ÿ
`InheritableThreadLocal` å¯ä»¥ç¡®ä¿å­çº¿ç¨‹ç»§æ‰¿çˆ¶çº¿ç¨‹çš„ `ThreadLocal` å˜é‡å€¼ï¼Œä½†æœ‰ä¸€äº›é™åˆ¶å’Œæ³¨æ„äº‹é¡¹ï¼š

### ç‰¹æ€§ä¸è¡Œä¸ºï¼š

1. **ç»§æ‰¿æœºåˆ¶**ï¼š
   - `InheritableThreadLocal` å…è®¸å­çº¿ç¨‹ç»§æ‰¿çˆ¶çº¿ç¨‹çš„ `ThreadLocal` å˜é‡å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ ä»çˆ¶çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹æ—¶ï¼Œå­çº¿ç¨‹å¯ä»¥è®¿é—®å’Œç»§æ‰¿çˆ¶çº¿ç¨‹ä¸­è®¾ç½®çš„ `InheritableThreadLocal` å˜é‡çš„å€¼ã€‚

2. **çº¿ç¨‹æ± ä¸­çš„è¡¨ç°**ï¼š
   - åœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼Œ`InheritableThreadLocal` ä¸ä¼šåƒ `TransmittableThreadLocal` é‚£æ ·åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´è‡ªåŠ¨ä¼ é€’ã€‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹é€šå¸¸ä¸ä¼šæ‹¥æœ‰ `InheritableThreadLocal` çš„ç»§æ‰¿åŠŸèƒ½ï¼Œå› ä¸ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯é‡å¤åˆ©ç”¨çš„ï¼Œçº¿ç¨‹æ± å¯èƒ½ä¼šåœ¨ä¸åŒçš„ä»»åŠ¡é—´å¤ç”¨ç›¸åŒçš„çº¿ç¨‹ï¼Œè¿™ä¼šå¯¼è‡´ç»§æ‰¿å…³ç³»çš„ä¸¢å¤±æˆ–ä¸ä¸€è‡´ã€‚

3. **æ‰‹åŠ¨ä¼ é€’**ï¼š
   - å¦‚æœä½ éœ€è¦åœ¨å¤šä¸ªçº¿ç¨‹é—´ä¼ é€’ `ThreadLocal` å˜é‡çš„å€¼ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨çº¿ç¨‹æ± çš„æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨ä¼ é€’è¿™äº›å€¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ä¹‹å‰ï¼Œå°† `ThreadLocal` çš„å€¼ä¿å­˜åˆ°æŸä¸ªåœ°æ–¹ï¼Œå¹¶åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶æ¢å¤è¿™äº›å€¼ã€‚

### ä»£ç ç¤ºä¾‹ï¼š

```java
public class InheritableThreadLocalExample {
    public static void main(String[] args) {
        InheritableThreadLocal<String> inheritableThreadLocal = new InheritableThreadLocal<>();
        
        // Set value in parent thread
        inheritableThreadLocal.set("Parent Value");

        // Create a new thread
        Thread childThread = new Thread(() -> {
            // Retrieve value in child thread
            String value = inheritableThreadLocal.get();
            System.out.println("Child Thread Value: " + value);
        });

        childThread.start();
    }
}
```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ`childThread` å¯ä»¥è®¿é—®çˆ¶çº¿ç¨‹ä¸­è®¾ç½®çš„ `InheritableThreadLocal` å€¼ã€‚

### æ³¨æ„äº‹é¡¹ï¼š

- **çº¿ç¨‹æ± åœºæ™¯**ï¼šåœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼Œè€ƒè™‘åˆ°çº¿ç¨‹å¤ç”¨ï¼Œ`InheritableThreadLocal` çš„å€¼å¯èƒ½ä¸ä¼šæŒ‰é¢„æœŸä¼ é€’ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ `TransmittableThreadLocal` æˆ–å…¶ä»–æœºåˆ¶å¯èƒ½æ›´åˆé€‚ã€‚

- **ä¸Šä¸‹æ–‡çš„æ¸…ç†**ï¼šå¦‚æœä½¿ç”¨ `InheritableThreadLocal`ï¼Œç¡®ä¿åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæˆåæ¸…ç†ä¸Šä¸‹æ–‡ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼æˆ–ä¸å¿…è¦çš„æ•°æ®ä¿ç•™ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œ`InheritableThreadLocal` åœ¨å­çº¿ç¨‹ä¸­å¯ä»¥è®¿é—®çˆ¶çº¿ç¨‹çš„å€¼ï¼Œä½†åœ¨ä½¿ç”¨çº¿ç¨‹æ± ç­‰å¤æ‚åœºæ™¯ä¸­ï¼Œå¯èƒ½éœ€è¦é¢å¤–çš„å¤„ç†æ¥ç¡®ä¿å€¼çš„ä¼ é€’å’Œä¸€è‡´æ€§ã€‚

# 3. æˆ‘ç”¨çš„å°±æ˜¯çº¿ç¨‹æ± ï¼Œå‘ç°æ± å­é‡Œé¢çš„çº¿ç¨‹ä¸ä¸€å®šæ¯æ¬¡éƒ½ä¼šæ‹¿åˆ°ä¸»çº¿ç¨‹çš„å˜é‡å‰¯æœ¬
åœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼Œ`InheritableThreadLocal` çš„å€¼ä¸ä¸€å®šæ¯æ¬¡éƒ½èƒ½æ­£ç¡®ä¼ é€’åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ã€‚è¿™æ˜¯å› ä¸ºçº¿ç¨‹æ± çš„çº¿ç¨‹æ˜¯å¤ç”¨çš„ï¼Œå¯èƒ½åœ¨æ‰§è¡Œå¤šä¸ªä»»åŠ¡æ—¶ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹ï¼Œè¿™å¯¼è‡´äº†ä»¥ä¸‹é—®é¢˜ï¼š

### ä¸»è¦é—®é¢˜

1. **çº¿ç¨‹å¤ç”¨**ï¼š
   - çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šè¢«å¤ç”¨æ¥æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡ä¿®æ”¹äº† `InheritableThreadLocal` çš„å€¼ï¼Œå¦ä¸€ä¸ªä»»åŠ¡åœ¨åŒä¸€çº¿ç¨‹ä¸Šæ‰§è¡Œæ—¶ï¼Œå¯èƒ½ä¼šçœ‹åˆ°ä¸åŒçš„å€¼ï¼Œæˆ–è€…å€¼å¯èƒ½ä¸ä¼šæ­£ç¡®ç»§æ‰¿ã€‚

2. **ä¸Šä¸‹æ–‡æ¸…ç†**ï¼š
   - ç”±äºçº¿ç¨‹æ± çº¿ç¨‹çš„å¤ç”¨ç‰¹æ€§ï¼Œ`InheritableThreadLocal` çš„ä¸Šä¸‹æ–‡å¯èƒ½ä¼šåœ¨ä»»åŠ¡å®Œæˆåæœªè¢«æ¸…ç†ï¼Œè¿™å¯èƒ½å¯¼è‡´å€¼ä¸ä¸€è‡´æˆ–è¿‡æœŸã€‚

### è§£å†³æ–¹æ¡ˆ

1. **ä½¿ç”¨ `TransmittableThreadLocal`**ï¼š
   - `TransmittableThreadLocal` æ˜¯ä¸€ä¸ªé’ˆå¯¹çº¿ç¨‹æ± å’Œå¼‚æ­¥ä»»åŠ¡çš„ä¸“é—¨å®ç°ï¼Œå®ƒæ”¯æŒè·¨çº¿ç¨‹ä¼ é€’å€¼ã€‚å®ƒé€šè¿‡åœ¨ä»»åŠ¡æäº¤ä¹‹å‰æ•è·å½“å‰çº¿ç¨‹çš„ `ThreadLocal` å€¼ï¼Œå¹¶åœ¨æ‰§è¡Œä»»åŠ¡æ—¶è®¾ç½®åˆ°çº¿ç¨‹ä¸­æ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚ä½¿ç”¨ `TransmittableThreadLocal` å¯ä»¥ç¡®ä¿çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹èƒ½å¤Ÿæ­£ç¡®ä¼ é€’å’Œæ¢å¤ `ThreadLocal` å€¼ã€‚

   ```java
   import com.alibaba.ttl.TransmittableThreadLocal;

   public class TransmittableThreadLocalExample {
       private static TransmittableThreadLocal<String> ttl = new TransmittableThreadLocal<>();

       public static void main(String[] args) {
           ttl.set("Parent Value");

           ExecutorService executor = Executors.newFixedThreadPool(1);
           executor.submit(() -> {
               System.out.println("ThreadLocal Value: " + ttl.get());
           });
           executor.shutdown();
       }
   }
   ```

2. **æ‰‹åŠ¨ä¼ é€’ä¸Šä¸‹æ–‡**ï¼š
   - å¦‚æœä¸ä½¿ç”¨ `TransmittableThreadLocal`ï¼Œä½ å¯ä»¥åœ¨æäº¤ä»»åŠ¡ä¹‹å‰æ‰‹åŠ¨ä¼ é€’ `ThreadLocal` çš„å€¼ã€‚ä¿å­˜ä¸»çº¿ç¨‹ä¸­çš„ `ThreadLocal` å€¼ï¼Œå¹¶åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶è®¾ç½®è¿™äº›å€¼ã€‚

   ```java
   import java.util.concurrent.ExecutorService;
   import java.util.concurrent.Executors;

   public class ManualThreadLocalExample {
       private static InheritableThreadLocal<String> inheritableThreadLocal = new InheritableThreadLocal<>();

       public static void main(String[] args) {
           inheritableThreadLocal.set("Parent Value");

           ExecutorService executor = Executors.newFixedThreadPool(1);
           executor.submit(() -> {
               String value = inheritableThreadLocal.get();
               System.out.println("ThreadLocal Value: " + value);
           });
           executor.shutdown();
       }
   }
   ```

   åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œéœ€è¦ç¡®ä¿çº¿ç¨‹æ± ä¸­çš„æ¯ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œå‰æ­£ç¡®åœ°è®¾ç½®äº† `ThreadLocal` å€¼ï¼Œå¹¶ä¸”åœ¨ä»»åŠ¡å®Œæˆåæ¸…ç†è¿™äº›å€¼ï¼Œä»¥é¿å…æ½œåœ¨çš„é—®é¢˜ã€‚

### æ€»ç»“

- åœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼Œ`InheritableThreadLocal` å¯èƒ½æ— æ³•ç¡®ä¿çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ¯æ¬¡éƒ½èƒ½è·å–åˆ°çˆ¶çº¿ç¨‹çš„å˜é‡å‰¯æœ¬ã€‚
- å¯ä»¥ä½¿ç”¨ `TransmittableThreadLocal` æ¥æ›´å¥½åœ°æ”¯æŒçº¿ç¨‹æ± ç¯å¢ƒä¸­çš„å€¼ä¼ é€’ã€‚
- æ‰‹åŠ¨ä¼ é€’å’Œç®¡ç† `ThreadLocal` çš„å€¼ä¹Ÿæ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä½†éœ€è¦é¢å¤–çš„ç®¡ç†å’Œæ¸…ç†å·¥ä½œã€‚

# 4. TransmittableThreadLocalå¯ä»¥ç¡®ä¿å§‹ç»ˆå°†ä¸»çº¿ç¨‹çš„å‰¯æœ¬æ­£ç¡®ä¼ é€’ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å—ï¼Ÿ
`TransmittableThreadLocal` æ˜¯ä¸“é—¨è®¾è®¡ç”¨æ¥è§£å†³åœ¨çº¿ç¨‹æ± ç­‰å¼‚æ­¥æ‰§è¡Œç¯å¢ƒä¸­ä¼ é€’ `ThreadLocal` å€¼çš„é—®é¢˜çš„ã€‚å®ƒèƒ½å¤Ÿåœ¨ä»»åŠ¡æäº¤æ—¶æ•è·å½“å‰çº¿ç¨‹çš„ `ThreadLocal` å€¼ï¼Œå¹¶åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶æ­£ç¡®åœ°å°†è¿™äº›å€¼ä¼ é€’ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ã€‚ä¸ä¼ ç»Ÿçš„ `ThreadLocal` å’Œ `InheritableThreadLocal` ä¸åŒï¼Œ`TransmittableThreadLocal` æ—¨åœ¨å¤„ç†è·¨çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¼ é€’é—®é¢˜ï¼Œå› æ­¤åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¡¨ç°è‰¯å¥½ï¼š

### ä¸»è¦ç‰¹ç‚¹ï¼š

1. **å€¼æ•è·ä¸ä¼ é€’**ï¼š
   - `TransmittableThreadLocal` åœ¨ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± æ—¶ï¼Œæ•è·å½“å‰çº¿ç¨‹çš„ `ThreadLocal` å€¼ï¼Œå¹¶åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ä¸­è®¾ç½®è¿™äº›å€¼ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹èƒ½å¤Ÿæ­£ç¡®è·å–åˆ°ä¸»çº¿ç¨‹çš„ `ThreadLocal` å€¼ã€‚

2. **çº¿ç¨‹æ± ç¯å¢ƒé€‚åº”**ï¼š
   - çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¤ç”¨çš„ï¼Œ`TransmittableThreadLocal` é€šè¿‡æ•è·å’Œä¼ é€’å€¼çš„æœºåˆ¶ï¼Œç¡®ä¿äº†å³ä½¿çº¿ç¨‹è¢«å¤ç”¨ï¼Œä¹Ÿèƒ½æ­£ç¡®åœ°å°†ä¸»çº¿ç¨‹çš„å€¼ä¼ é€’åˆ°æ–°çš„ä»»åŠ¡ä¸­ã€‚

3. **è·¨å¼‚æ­¥ä»»åŠ¡ä¼ é€’**ï¼š
   - å¯¹äºå¼‚æ­¥ä»»åŠ¡å’Œå¹¶å‘ä»»åŠ¡ï¼Œ`TransmittableThreadLocal` èƒ½å¤Ÿæœ‰æ•ˆåœ°ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½¿å¾—å¼‚æ­¥æ“ä½œèƒ½å¤Ÿè·å–åˆ°æ‰€éœ€çš„ä¸Šä¸‹æ–‡æ•°æ®ã€‚

### ç¤ºä¾‹ä»£ç ï¼š

```java
import com.alibaba.ttl.TransmittableThreadLocal;

public class TransmittableThreadLocalExample {
    private static TransmittableThreadLocal<String> ttl = new TransmittableThreadLocal<>();

    public static void main(String[] args) {
        ttl.set("Parent Value");

        ExecutorService executor = Executors.newFixedThreadPool(1);
        executor.submit(() -> {
            // This should correctly print "Parent Value" in the context of the task
            System.out.println("ThreadLocal Value: " + ttl.get());
        });
        executor.shutdown();
    }
}
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ`TransmittableThreadLocal` ç¡®ä¿äº†çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹èƒ½å¤Ÿè®¿é—®åˆ°ä¸»çº¿ç¨‹ä¸­è®¾ç½®çš„å€¼ã€‚

### æ³¨æ„äº‹é¡¹ï¼š

1. **æ€§èƒ½å½±å“**ï¼š
   - `TransmittableThreadLocal` çš„å®ç°æ¶‰åŠåˆ°é¢å¤–çš„å€¼æ•è·å’Œè®¾ç½®æ“ä½œï¼Œå¯èƒ½ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œå°¤å…¶æ˜¯åœ¨é¢‘ç¹æäº¤ä»»åŠ¡çš„åœºæ™¯ä¸­ã€‚

2. **çº¿ç¨‹ä¸Šä¸‹æ–‡çš„æ¸…ç†**ï¼š
   - åœ¨ä½¿ç”¨ `TransmittableThreadLocal` æ—¶ï¼Œç¡®ä¿åœ¨ä»»åŠ¡å®Œæˆåæ¸…ç†ä¸Šä¸‹æ–‡ï¼Œä»¥é¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼æˆ–ä¸Šä¸‹æ–‡æ•°æ®æ±¡æŸ“ã€‚

3. **å…¼å®¹æ€§**ï¼š
   - `TransmittableThreadLocal` ä¸»è¦æ˜¯ä¸€ä¸ªæ‰©å±•åº“ï¼ˆä¾‹å¦‚ Alibaba çš„ `transmittable-thread-local`ï¼‰ï¼Œå¯èƒ½éœ€è¦é¢å¤–çš„ä¾èµ–å’Œé…ç½®ã€‚

### æ€»ç»“ï¼š

`TransmittableThreadLocal` èƒ½å¤Ÿæœ‰æ•ˆåœ°åœ¨çº¿ç¨‹æ± ç­‰å¼‚æ­¥æ‰§è¡Œç¯å¢ƒä¸­ä¼ é€’ `ThreadLocal` çš„å€¼ï¼Œç¡®ä¿ä¸»çº¿ç¨‹çš„ä¸Šä¸‹æ–‡å¯ä»¥è¢«æ­£ç¡®åœ°ä¼ é€’åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸­ã€‚å®ƒæä¾›äº†å¯¹çº¿ç¨‹æ± å’Œå¼‚æ­¥ä»»åŠ¡çš„æ›´å¥½çš„æ”¯æŒï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„ `ThreadLocal` å’Œ `InheritableThreadLocal`ï¼Œåœ¨å¤„ç†è·¨çº¿ç¨‹ä¸Šä¸‹æ–‡ä¼ é€’æ—¶è¡¨ç°æ›´åŠ å¯é ã€‚

# 5. ä½†æ˜¯åœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œå‘ç°TransmittableThreadLocal ä¹Ÿæ²¡æ³•æ­£ç¡®è·å–åˆ°ä¸Šæœ‰æœåŠ¡è®¾ç½®è¿›å»çš„å€¼
å¦‚æœ `TransmittableThreadLocal` åœ¨ä½ çš„æµ‹è¯•ä¸­æ— æ³•æ­£ç¡®è·å–ä¸Šæ¸¸æœåŠ¡è®¾ç½®çš„å€¼ï¼Œå¯èƒ½æ˜¯ç”±äºä»¥ä¸‹åŸå› ï¼š

### å¯èƒ½çš„åŸå› åŠè§£å†³æ–¹æ¡ˆ

1. **ä¾èµ–é—®é¢˜**ï¼š
   - ç¡®ä¿ä½ ä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ `TransmittableThreadLocal` åº“ï¼Œå¹¶ä¸”æ­£ç¡®åœ°å¼•å…¥äº†ç›¸å…³çš„ä¾èµ–ã€‚å¦‚æœä¾èµ–ç‰ˆæœ¬ä¸åŒ¹é…æˆ–é…ç½®é”™è¯¯ï¼Œå¯èƒ½å¯¼è‡´åŠŸèƒ½å¼‚å¸¸ã€‚

   ```xml
   <!-- Maven dependency example -->
   <dependency>
       <groupId>com.alibaba</groupId>
       <artifactId>transmittable-thread-local</artifactId>
       <version>2.0.0</version>
   </dependency>
   ```

2. **ä¸Šä¸‹æ–‡æ•è·ä¸å®Œæ•´**ï¼š
   - ç¡®ä¿åœ¨æäº¤ä»»åŠ¡ä¹‹å‰ï¼Œ`TransmittableThreadLocal` å·²ç»æ­£ç¡®è®¾ç½®äº†å€¼ã€‚åœ¨ä»»åŠ¡æäº¤ä¹‹å‰è°ƒç”¨ `set` æ–¹æ³•æ¥ç¡®ä¿å€¼è¢«æ•è·å’Œä¼ é€’ã€‚

   ```java
   TransmittableThreadLocal<String> ttl = new TransmittableThreadLocal<>();
   ttl.set("Value to be transmitted");

   ExecutorService executor = Executors.newFixedThreadPool(1);
   executor.submit(() -> {
       System.out.println("Value in task: " + ttl.get());
   });
   executor.shutdown();
   ```

3. **çº¿ç¨‹æ± é…ç½®é—®é¢˜**ï¼š
   - å¦‚æœä½ ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰çš„çº¿ç¨‹æ± æˆ–å¼‚æ­¥æ¡†æ¶ï¼Œç¡®ä¿å…¶æ­£ç¡®æ”¯æŒ `TransmittableThreadLocal`ã€‚æœ‰äº›çº¿ç¨‹æ± å®ç°å¯èƒ½ä¼šå¹²æ‰°çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ä¼ é€’ã€‚

4. **çº¿ç¨‹æ± çº¿ç¨‹å¤ç”¨**ï¼š
   - ç”±äºçº¿ç¨‹æ± çš„çº¿ç¨‹æ˜¯å¤ç”¨çš„ï¼Œç¡®ä¿åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶ä¸Šä¸‹æ–‡å€¼æ˜¯æœ€æ–°çš„ã€‚å¦‚æœæœ‰å¤šä¸ªä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œç¡®è®¤ä»»åŠ¡åœ¨æäº¤å’Œæ‰§è¡ŒæœŸé—´çš„ä¸Šä¸‹æ–‡ä¼ é€’é€»è¾‘æ˜¯å¦æ­£ç¡®ã€‚

5. **é”™è¯¯çš„çº¿ç¨‹ç¯å¢ƒ**ï¼š
   - ç¡®ä¿åœ¨æµ‹è¯•æ—¶ï¼Œæ‰€æœ‰ç›¸å…³çš„çº¿ç¨‹éƒ½æ˜¯ç”± `TransmittableThreadLocal` æ§åˆ¶çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤æ‚çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œçº¿ç¨‹åˆ‡æ¢æˆ–ç¬¬ä¸‰æ–¹åº“å¯èƒ½ä¼šå½±å“ä¸Šä¸‹æ–‡ä¼ é€’ã€‚

6. **è°ƒè¯•å’Œæ—¥å¿—**ï¼š
   - ä½¿ç”¨æ—¥å¿—è®°å½•å’Œè°ƒè¯•å·¥å…·æ£€æŸ¥ `TransmittableThreadLocal` çš„è®¾ç½®å’Œè·å–æ“ä½œï¼Œç¡®ä¿å€¼åœ¨é¢„æœŸçš„æ—¶é—´ç‚¹è¢«æ­£ç¡®åœ°è®¾ç½®å’Œä¼ é€’ã€‚

### è°ƒè¯•æ­¥éª¤

1. **ç®€åŒ–æµ‹è¯•**ï¼š
   - å°è¯•ä½¿ç”¨æœ€ç®€å•çš„ `TransmittableThreadLocal` ç¤ºä¾‹æ¥éªŒè¯å®ƒçš„åŸºæœ¬åŠŸèƒ½ï¼Œä»¥æ’é™¤ç¯å¢ƒå’Œé…ç½®é—®é¢˜ã€‚

2. **æ‰“å°å’ŒéªŒè¯**ï¼š
   - åœ¨ä»»åŠ¡æ‰§è¡Œçš„ä»£ç å—ä¸­æ‰“å° `TransmittableThreadLocal` çš„å€¼ï¼Œå¹¶ä¸ä¸»çº¿ç¨‹ä¸­çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œä»¥éªŒè¯ä¼ é€’æ˜¯å¦æˆåŠŸã€‚

3. **æ£€æŸ¥åº“ç‰ˆæœ¬**ï¼š
   - ç¡®ä¿ä½ çš„é¡¹ç›®ä¸­æ²¡æœ‰å¤šä¸ªç‰ˆæœ¬çš„ `TransmittableThreadLocal` ä¾èµ–å†²çªï¼Œå¹¶ä½¿ç”¨çš„æ˜¯ç¨³å®šç‰ˆæœ¬ã€‚

### ç¤ºä¾‹ä»£ç 

```java
import com.alibaba.ttl.TransmittableThreadLocal;

public class TransmittableThreadLocalTest {
    private static final TransmittableThreadLocal<String> ttl = new TransmittableThreadLocal<>();

    public static void main(String[] args) {
        ttl.set("Value in main thread");

        ExecutorService executor = Executors.newFixedThreadPool(1);
        executor.submit(() -> {
            System.out.println("Value in thread pool task: " + ttl.get());
        });
        executor.shutdown();
    }
}
```

ç¡®ä¿åœ¨æäº¤ä»»åŠ¡ä¹‹å‰è®¾ç½® `TransmittableThreadLocal` çš„å€¼ï¼Œå¹¶åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶è·å–è¿™äº›å€¼ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥éªŒè¯ `TransmittableThreadLocal` æ˜¯å¦èƒ½æ­£ç¡®ä¼ é€’ä¸Šä¸‹æ–‡ã€‚

# 6. submitå‰è¿˜éœ€è¦æ‰‹åŠ¨æ•è·ï¼Ÿæ‰èƒ½æ­£ç¡®ä¼ é€’ï¼Ÿåˆ°åº•è¯¥å¦‚ä½•ä½¿ç”¨ TransmittableThreadLocal  å‘¢ï¼Ÿè¯·è¯¦ç»†è§£é‡Š
`TransmittableThreadLocal` æ˜¯ä¸€ç§æ‰©å±•çš„çº¿ç¨‹å±€éƒ¨å˜é‡å®ç°ï¼Œç”¨äºç¡®ä¿åœ¨ä½¿ç”¨çº¿ç¨‹æ± ç­‰å¼‚æ­¥æ‰§è¡Œç¯å¢ƒæ—¶ï¼Œçº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼èƒ½å¤Ÿè¢«æ­£ç¡®ä¼ é€’ã€‚å®ƒé€šè¿‡æ•è·å’Œä¼ é€’ `ThreadLocal` çš„å€¼æ¥å®ç°è·¨çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ä¼ é€’ã€‚ä¸‹é¢æ˜¯å¦‚ä½•æ­£ç¡®ä½¿ç”¨ `TransmittableThreadLocal` çš„è¯¦ç»†è§£é‡Šã€‚

### 1. åŸºæœ¬æ¦‚å¿µ

`TransmittableThreadLocal` å¯ä»¥åœ¨å­çº¿ç¨‹ä¸­è·å–åˆ°çˆ¶çº¿ç¨‹çš„ `ThreadLocal` å€¼ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨æ•è·å’Œè®¾ç½®ã€‚è¿™ä½¿å¾—å®ƒåœ¨å¼‚æ­¥ä»»åŠ¡å’Œçº¿ç¨‹æ± ä¸­éå¸¸æœ‰ç”¨ã€‚å®ƒä¸ `ThreadLocal` å’Œ `InheritableThreadLocal` çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒèƒ½å¤Ÿå¤„ç†çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤ç”¨é—®é¢˜ã€‚

### 2. ä½¿ç”¨æ–¹æ³•

#### ä¾èµ–é…ç½®

é¦–å…ˆï¼Œç¡®ä¿ä½ å·²ç»åœ¨é¡¹ç›®ä¸­æ­£ç¡®é…ç½®äº† `TransmittableThreadLocal` ç›¸å…³çš„ä¾èµ–ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Mavenï¼Œå¯ä»¥åœ¨ `pom.xml` ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š

```xml
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>transmittable-thread-local</artifactId>
    <version>2.0.0</version>
</dependency>
```

#### ç¤ºä¾‹ä»£ç 

ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `TransmittableThreadLocal` ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š

```java
import com.alibaba.ttl.TransmittableThreadLocal;

import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class TransmittableThreadLocalExample {
    // åˆ›å»º TransmittableThreadLocal å®ä¾‹
    private static final TransmittableThreadLocal<String> ttl = new TransmittableThreadLocal<>();

    public static void main(String[] args) {
        // åœ¨ä¸»çº¿ç¨‹ä¸­è®¾ç½®å€¼
        ttl.set("Value from main thread");

        // åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± 
        ExecutorService executor = Executors.newFixedThreadPool(1);

        // æäº¤ä»»åŠ¡
        executor.submit(() -> {
            // åœ¨çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡ä¸­è·å–å€¼
            String value = ttl.get();
            System.out.println("Value in thread pool task: " + value);
        });

        // å…³é—­çº¿ç¨‹æ± 
        executor.shutdown();
    }
}
```

### 3. å·¥ä½œåŸç†

1. **æ•è·å€¼**ï¼š
   - å½“ä½ åœ¨ä¸»çº¿ç¨‹ä¸­è®¾ç½® `TransmittableThreadLocal` çš„å€¼æ—¶ï¼Œ`TransmittableThreadLocal` ä¼šè‡ªåŠ¨æ•è·è¿™äº›å€¼ï¼Œå¹¶åœ¨åˆ›å»ºä»»åŠ¡æ—¶ä¿å­˜è¿™äº›å€¼ã€‚

2. **ä¼ é€’å€¼**ï¼š
   - å½“ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± å¹¶æ‰§è¡Œæ—¶ï¼Œ`TransmittableThreadLocal` ä¼šå°†ä¸»çº¿ç¨‹ä¸­çš„ `ThreadLocal` å€¼ä¼ é€’åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯è‡ªåŠ¨çš„ï¼Œæ— éœ€æ‰‹åŠ¨æ•è·ã€‚

3. **çº¿ç¨‹å¤ç”¨**ï¼š
   - `TransmittableThreadLocal` å¤„ç†çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤ç”¨é—®é¢˜ã€‚å®ƒç¡®ä¿æ¯ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œæ—¶éƒ½èƒ½è·å¾—æ­£ç¡®çš„ `ThreadLocal` å€¼ã€‚

### 4. å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

1. **å€¼æœªä¼ é€’**ï¼š
   - ç¡®ä¿åœ¨æäº¤ä»»åŠ¡ä¹‹å‰å·²ç»è®¾ç½®äº† `TransmittableThreadLocal` çš„å€¼ã€‚å¦‚æœæäº¤ä»»åŠ¡æ—¶æ²¡æœ‰å€¼ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å°†æ— æ³•è·å¾—æ­£ç¡®çš„å€¼ã€‚

2. **ä¸Šä¸‹æ–‡æ±¡æŸ“**ï¼š
   - å¦‚æœä½ åœ¨ä»»åŠ¡ä¸­ä¿®æ”¹äº† `TransmittableThreadLocal` çš„å€¼ï¼Œéœ€è¦æ³¨æ„æ¸…ç†è¿™äº›å€¼ï¼Œä»¥é¿å…å¯¹åç»­ä»»åŠ¡çš„ä¸Šä¸‹æ–‡äº§ç”Ÿå½±å“ã€‚å¯ä»¥ä½¿ç”¨ `remove` æ–¹æ³•æ¸…é™¤å€¼ï¼š

   ```java
   ttl.remove();
   ```

3. **çº¿ç¨‹æ± é…ç½®**ï¼š
   - ç¡®ä¿ä½¿ç”¨çš„çº¿ç¨‹æ± å®ç°æ”¯æŒ `TransmittableThreadLocal`ã€‚å¤§å¤šæ•°æ ‡å‡†çš„ `ExecutorService` å®ç°éƒ½åº”è¯¥æ”¯æŒï¼Œä½†åœ¨ä¸€äº›è‡ªå®šä¹‰å®ç°ä¸­å¯èƒ½éœ€è¦é¢å¤–çš„é…ç½®ã€‚

### 5. æ€»ç»“

- **è‡ªåŠ¨æ•è·å’Œä¼ é€’**ï¼š`TransmittableThreadLocal` è‡ªåŠ¨æ•è·å’Œä¼ é€’ä¸Šä¸‹æ–‡ï¼Œæ— éœ€æ‰‹åŠ¨æ•è·ã€‚
- **é€‚ç”¨äºçº¿ç¨‹æ± **ï¼šç‰¹åˆ«é€‚åˆåœ¨çº¿ç¨‹æ± å’Œå¼‚æ­¥ä»»åŠ¡ä¸­ä½¿ç”¨ã€‚
- **ç¡®ä¿æ­£ç¡®è®¾ç½®**ï¼šåœ¨æäº¤ä»»åŠ¡ä¹‹å‰è®¾ç½®å¥½ `TransmittableThreadLocal` çš„å€¼ï¼Œå¹¶åœ¨ä»»åŠ¡ä¸­è·å–ã€‚

é€šè¿‡ä¸Šè¿°ç¤ºä¾‹å’Œè§£é‡Šï¼Œä½ åº”è¯¥èƒ½å¤Ÿåœ¨ä½ çš„é¡¹ç›®ä¸­æ­£ç¡®ä½¿ç”¨ `TransmittableThreadLocal`ï¼Œç¡®ä¿åœ¨çº¿ç¨‹æ± ç­‰å¼‚æ­¥ç¯å¢ƒä¸­ä¸Šä¸‹æ–‡ä¿¡æ¯çš„æ­£ç¡®ä¼ é€’ã€‚

# 7. æˆ‘çš„ä»£ç ä¸­æ‰¾åˆ°äº†TtlExecutorï¼ŒåŒæ—¶è¿˜æœ‰ TransmittableThreadLocal ï¼Œåˆ°åº•è¯¥å¦‚ä½•ä½¿ç”¨ï¼Ÿ
`TtlExecutor` å’Œ `TransmittableThreadLocal` éƒ½æ˜¯ `transmittable-thread-local` åº“çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºè§£å†³çº¿ç¨‹æ± å’Œå¼‚æ­¥ä»»åŠ¡ä¸­ä¸Šä¸‹æ–‡ä¼ é€’çš„é—®é¢˜ã€‚å®ƒä»¬çš„ç»“åˆä½¿ç”¨å¯ä»¥ç¡®ä¿ `ThreadLocal` çš„å€¼åœ¨å¼‚æ­¥ä»»åŠ¡ä¸­è¢«æ­£ç¡®ä¼ é€’ã€‚

### `TransmittableThreadLocal` å’Œ `TtlExecutor` çš„ä½œç”¨

- **`TransmittableThreadLocal`**: è¿™æ˜¯ä¸€ä¸ªå¢å¼ºç‰ˆçš„ `ThreadLocal`ï¼Œå®ƒæ”¯æŒè·¨çº¿ç¨‹ä¼ é€’å€¼ã€‚å®ƒä¼šåœ¨ä»»åŠ¡æäº¤æ—¶è‡ªåŠ¨æ•è·ä¸»çº¿ç¨‹ä¸­çš„å€¼ï¼Œå¹¶åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶ä¼ é€’è¿™äº›å€¼ã€‚

- **`TtlExecutor`**: è¿™æ˜¯ä¸€ä¸ªç”¨äºå°† `TransmittableThreadLocal` çš„åŠŸèƒ½é›†æˆåˆ°çº¿ç¨‹æ± ä¸­çš„å·¥å…·ç±»ã€‚å®ƒå¯ä»¥åŒ…è£…ä¸€ä¸ªæ ‡å‡†çš„ `Executor`ï¼Œä½¿å¾—çº¿ç¨‹æ± èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç† `TransmittableThreadLocal` çš„å€¼ä¼ é€’ã€‚

### å¦‚ä½•ä½¿ç”¨

#### 1. å¼•å…¥ä¾èµ–

é¦–å…ˆï¼Œç¡®ä¿ä½ å·²ç»åœ¨é¡¹ç›®ä¸­å¼•å…¥äº† `transmittable-thread-local` åº“çš„ç›¸å…³ä¾èµ–ï¼š

```xml
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>transmittable-thread-local</artifactId>
    <version>2.0.0</version>
</dependency>
```

#### 2. ä½¿ç”¨ `TransmittableThreadLocal`

åˆ›å»ºå’Œä½¿ç”¨ `TransmittableThreadLocal` çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
import com.alibaba.ttl.TransmittableThreadLocal;

public class TransmittableThreadLocalExample {
    private static final TransmittableThreadLocal<String> ttl = new TransmittableThreadLocal<>();

    public static void main(String[] args) {
        ttl.set("Value from main thread");

        // åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± å¹¶ä½¿ç”¨ TtlExecutor
        ExecutorService executor = Executors.newFixedThreadPool(1);
        ExecutorService ttlExecutor = TtlExecutors.getTtlExecutor(executor);

        ttlExecutor.submit(() -> {
            // åœ¨çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡ä¸­è·å–å€¼
            String value = ttl.get();
            System.out.println("Value in thread pool task: " + value);
        });

        ttlExecutor.shutdown();
    }
}
```

#### 3. ä½¿ç”¨ `TtlExecutor`

åœ¨ä½¿ç”¨ `TransmittableThreadLocal` çš„çº¿ç¨‹æ± ä¸­ï¼Œéœ€è¦ä½¿ç”¨ `TtlExecutor` æ¥ç¡®ä¿ `ThreadLocal` å€¼èƒ½å¤Ÿæ­£ç¡®ä¼ é€’ã€‚`TtlExecutors.getTtlExecutor` æ–¹æ³•å¯ä»¥å°†æ ‡å‡†çš„ `Executor` è½¬æ¢ä¸ºæ”¯æŒ `TransmittableThreadLocal` çš„æ‰§è¡Œå™¨ã€‚

ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ `TtlExecutor` åŒ…è£…ä¸€ä¸ªæ ‡å‡†çš„ `ExecutorService`ï¼š

```java
import com.alibaba.ttl.TtlExecutors;
import com.alibaba.ttl.TransmittableThreadLocal;

import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class TtlExecutorExample {
    private static final TransmittableThreadLocal<String> ttl = new TransmittableThreadLocal<>();

    public static void main(String[] args) {
        ttl.set("Value from main thread");

        // åˆ›å»ºä¸€ä¸ªæ ‡å‡†çš„çº¿ç¨‹æ± 
        ExecutorService executor = Executors.newFixedThreadPool(1);

        // ä½¿ç”¨ TtlExecutor åŒ…è£…çº¿ç¨‹æ± 
        ExecutorService ttlExecutor = TtlExecutors.getTtlExecutor(executor);

        ttlExecutor.submit(() -> {
            // åœ¨ä»»åŠ¡ä¸­è·å– TransmittableThreadLocal çš„å€¼
            String value = ttl.get();
            System.out.println("Value in thread pool task: " + value);
        });

        ttlExecutor.shutdown();
    }
}
```

### 4. æ³¨æ„äº‹é¡¹

- **ä¸Šä¸‹æ–‡æ•è·**ï¼šç¡®ä¿åœ¨ä»»åŠ¡æäº¤ä¹‹å‰è®¾ç½® `TransmittableThreadLocal` çš„å€¼ã€‚è¿™æ ·ï¼Œä»»åŠ¡åœ¨æ‰§è¡Œæ—¶æ‰èƒ½æ­£ç¡®åœ°è·å–åˆ°è¿™äº›å€¼ã€‚

- **çº¿ç¨‹æ± å¤ç”¨**ï¼š`TtlExecutor` å¤„ç†çº¿ç¨‹å¤ç”¨çš„é—®é¢˜ï¼Œç¡®ä¿æ¯æ¬¡ä»»åŠ¡æ‰§è¡Œæ—¶çš„ä¸Šä¸‹æ–‡éƒ½èƒ½æ­£ç¡®ä¼ é€’ã€‚

- **æ¸…ç†ä¸Šä¸‹æ–‡**ï¼šåœ¨ä½¿ç”¨ `TransmittableThreadLocal` æ—¶ï¼Œæ³¨æ„åœ¨ä»»åŠ¡å®Œæˆåæ¸…ç†ä¸Šä¸‹æ–‡ï¼Œä»¥é¿å…ä¸Šä¸‹æ–‡æ±¡æŸ“ã€‚

### æ€»ç»“

- **ä½¿ç”¨ `TransmittableThreadLocal`**ï¼šåˆ›å»º `TransmittableThreadLocal` å®ä¾‹å¹¶åœ¨ä¸»çº¿ç¨‹ä¸­è®¾ç½®å€¼ã€‚
- **ä½¿ç”¨ `TtlExecutor`**ï¼šå°†æ ‡å‡†çš„ `ExecutorService` åŒ…è£…æˆ `TtlExecutor`ï¼Œç¡®ä¿åœ¨å¼‚æ­¥ä»»åŠ¡ä¸­èƒ½å¤Ÿæ­£ç¡®ä¼ é€’ `ThreadLocal` çš„å€¼ã€‚
- **æ³¨æ„ä¸Šä¸‹æ–‡ç®¡ç†**ï¼šç¡®ä¿åœ¨çº¿ç¨‹æ± ä»»åŠ¡ä¸­èƒ½å¤Ÿæ­£ç¡®ä¼ é€’å’Œç®¡ç†ä¸Šä¸‹æ–‡æ•°æ®ã€‚

é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œä½ å¯ä»¥ç¡®ä¿ `TransmittableThreadLocal` çš„å€¼åœ¨ä½¿ç”¨çº¿ç¨‹æ± ç­‰å¼‚æ­¥æ‰§è¡Œç¯å¢ƒæ—¶èƒ½å¤Ÿè¢«æ­£ç¡®åœ°ä¼ é€’ã€‚

# 8. ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦åœ¨çº¿ç¨‹æ± ä¸­ä½¿ç”¨ TransmittableThreadLocal ï¼Œå¿…é¡»é€šè¿‡TtlExecutorè¿›è¡ŒåŒ…è£…æ‰èƒ½æ­£ç¡®ä½¿ç”¨ï¼Ÿ
æ˜¯çš„ï¼Œä½¿ç”¨ `TransmittableThreadLocal` åœ¨çº¿ç¨‹æ± ä¸­ç¡®å®éœ€è¦é€šè¿‡ `TtlExecutor` è¿›è¡ŒåŒ…è£…ã€‚è¿™æ˜¯å› ä¸ºæ ‡å‡†çš„çº¿ç¨‹æ± ï¼ˆä¾‹å¦‚ `Executors.newFixedThreadPool`ï¼‰å¹¶ä¸è‡ªåŠ¨æ”¯æŒè·¨çº¿ç¨‹ä¼ é€’ `ThreadLocal` çš„å€¼ï¼Œè€Œ `TtlExecutor` æ˜¯ä¸“é—¨è®¾è®¡ç”¨æ¥å¤„ç†è¿™ç§æƒ…å†µçš„ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦ `TtlExecutor`

- **çº¿ç¨‹å¤ç”¨é—®é¢˜**ï¼šçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¤ç”¨çš„ã€‚å³ä½¿ä½ åœ¨ä¸»çº¿ç¨‹ä¸­è®¾ç½®äº† `TransmittableThreadLocal` çš„å€¼ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šè¢«å¤šä¸ªä»»åŠ¡å¤ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`TransmittableThreadLocal` çš„å€¼å¿…é¡»è¢«æ­£ç¡®æ•è·å’Œä¼ é€’ã€‚

- **è‡ªåŠ¨æ•è·å’Œä¼ é€’**ï¼š`TtlExecutor` ä¼šåœ¨ä»»åŠ¡æäº¤æ—¶æ•è·å½“å‰çº¿ç¨‹çš„ `TransmittableThreadLocal` å€¼ï¼Œå¹¶åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶å°†è¿™äº›å€¼ä¼ é€’åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ã€‚æ²¡æœ‰è¿™ä¸ªåŒ…è£…ï¼Œ`TransmittableThreadLocal` çš„å€¼ä¸ä¼šè¢«æ­£ç¡®åœ°ä¼ é€’åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ã€‚

### å¦‚ä½•ä½¿ç”¨ `TtlExecutor`

1. **åˆ›å»º `TransmittableThreadLocal` å®ä¾‹**ï¼š

   ```java
   import com.alibaba.ttl.TransmittableThreadLocal;

   public class Example {
       private static final TransmittableThreadLocal<String> ttl = new TransmittableThreadLocal<>();
   }
   ```

2. **è®¾ç½®å€¼**ï¼š

   ```java
   ttl.set("Value from main thread");
   ```

3. **åˆ›å»ºå’ŒåŒ…è£…çº¿ç¨‹æ± **ï¼š

   ```java
   import com.alibaba.ttl.TtlExecutors;

   ExecutorService executor = Executors.newFixedThreadPool(1);
   ExecutorService ttlExecutor = TtlExecutors.getTtlExecutor(executor);
   ```

4. **æäº¤ä»»åŠ¡**ï¼š

   ```java
   ttlExecutor.submit(() -> {
       // åœ¨ä»»åŠ¡ä¸­è·å– TransmittableThreadLocal çš„å€¼
       String value = ttl.get();
       System.out.println("Value in thread pool task: " + value);
   });

   ttlExecutor.shutdown();
   ```

### å®Œæ•´ç¤ºä¾‹

ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶æ­£ç¡®åœ°ä½¿ç”¨ `TransmittableThreadLocal` å’Œ `TtlExecutor`ï¼š

```java
import com.alibaba.ttl.TransmittableThreadLocal;
import com.alibaba.ttl.TtlExecutors;

import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class TtlExecutorExample {
    // åˆ›å»º TransmittableThreadLocal å®ä¾‹
    private static final TransmittableThreadLocal<String> ttl = new TransmittableThreadLocal<>();

    public static void main(String[] args) {
        // åœ¨ä¸»çº¿ç¨‹ä¸­è®¾ç½®å€¼
        ttl.set("Value from main thread");

        // åˆ›å»ºä¸€ä¸ªæ ‡å‡†çš„çº¿ç¨‹æ± 
        ExecutorService executor = Executors.newFixedThreadPool(1);

        // ä½¿ç”¨ TtlExecutor åŒ…è£…çº¿ç¨‹æ± 
        ExecutorService ttlExecutor = TtlExecutors.getTtlExecutor(executor);

        // æäº¤ä»»åŠ¡
        ttlExecutor.submit(() -> {
            // åœ¨ä»»åŠ¡ä¸­è·å– TransmittableThreadLocal çš„å€¼
            String value = ttl.get();
            System.out.println("Value in thread pool task: " + value);
        });

        // å…³é—­çº¿ç¨‹æ± 
        ttlExecutor.shutdown();
    }
}
```

### ç»“è®º

- **åŒ…è£…çº¿ç¨‹æ± **ï¼šå¿…é¡»ä½¿ç”¨ `TtlExecutor` æ¥åŒ…è£…æ ‡å‡†çº¿ç¨‹æ± ï¼Œä»¥ä¾¿æ­£ç¡®ä¼ é€’ `TransmittableThreadLocal` çš„å€¼ã€‚
- **ç¡®ä¿æ•è·å’Œä¼ é€’**ï¼š`TtlExecutor` ä¼šç¡®ä¿ `TransmittableThreadLocal` çš„å€¼åœ¨ä»»åŠ¡æäº¤æ—¶è¢«æ•è·ï¼Œå¹¶åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶æ­£ç¡®åœ°ä¼ é€’ã€‚

é€šè¿‡ä½¿ç”¨ `TtlExecutor`ï¼Œä½ å¯ä»¥ç¡®ä¿åœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ `TransmittableThreadLocal` çš„å€¼èƒ½å¤Ÿè¢«æ­£ç¡®åœ°ä¼ é€’å’Œç®¡ç†ã€‚

# 9. TransmittableThreadLocalä¼šè‡ªåŠ¨å°†å½“å‰çº¿ç¨‹ä¸­çš„æ‰€æœ‰å‰¯æœ¬å€¼éƒ½è‡ªåŠ¨ä¼ é€’ç»™æ‰€æœ‰çš„çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å—ï¼Ÿä¼ é€’å®Œæˆåéœ€è¦æ‰‹åŠ¨æ§åˆ¶çº¿ç¨‹æ± ä¸­çš„å‰¯æœ¬æ¸…ç†å·¥ä½œå—ï¼Ÿå¦‚æœaçº¿ç¨‹åˆšä¼ é€’å®Œï¼Œbçº¿ç¨‹åˆæäº¤äº†ä¸€ä¸ªä»»åŠ¡ï¼Œæ­¤æ—¶æ± ä¸­çš„çº¿ç¨‹æ‹¿åˆ°çš„å‰¯æœ¬ä¸ä¼šé”™ä¹±å—ï¼Ÿ
`TransmittableThreadLocal` åœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ç¡®å®å¯ä»¥è‡ªåŠ¨å°†å½“å‰çº¿ç¨‹çš„å‰¯æœ¬å€¼ä¼ é€’ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œä½†å®ƒçš„å·¥ä½œæ–¹å¼å’Œå‰¯æœ¬çš„ç®¡ç†æœºåˆ¶æœ‰ä¸€äº›éœ€è¦ç‰¹åˆ«æ³¨æ„çš„åœ°æ–¹ã€‚

### 1. è‡ªåŠ¨ä¼ é€’æœºåˆ¶

`TransmittableThreadLocal` ä¼šåœ¨ä»»åŠ¡æäº¤ï¼ˆå³ `submit` æˆ– `execute`ï¼‰æ—¶ï¼Œè‡ªåŠ¨æ•è·å½“å‰çº¿ç¨‹çš„æ‰€æœ‰ `TransmittableThreadLocal` å‰¯æœ¬å€¼ï¼Œå¹¶å°†è¿™äº›å‰¯æœ¬å€¼ä¸æäº¤çš„ä»»åŠ¡ç»‘å®šã€‚å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¼€å§‹æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œè¿™äº›å‰¯æœ¬å€¼ä¼šè¢«ä¼ é€’åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ã€‚

**æ³¨æ„**ï¼šè¿™ä¸ªä¼ é€’æ˜¯ä»»åŠ¡çº§åˆ«çš„ï¼Œè€Œä¸æ˜¯çº¿ç¨‹çº§åˆ«çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½ä¼šç‹¬ç«‹åœ°æ•è·å¹¶ä¼ é€’ä¸»çº¿ç¨‹çš„ `TransmittableThreadLocal` å€¼ï¼Œç¡®ä¿ä»»åŠ¡æ‰§è¡Œæ—¶ä¸Šä¸‹æ–‡æ­£ç¡®ã€‚

### 2. çº¿ç¨‹æ± ä¸­çš„å‰¯æœ¬æ¸…ç†

ä¼ é€’å®Œæˆåï¼Œ`TransmittableThreadLocal` åœ¨ä»»åŠ¡æ‰§è¡Œç»“æŸæ—¶ï¼Œä¼šè‡ªåŠ¨æ¸…ç†çº¿ç¨‹æ± çº¿ç¨‹ä¸­çš„å‰¯æœ¬ã€‚è¿™æ˜¯ç”± `TtlExecutor` å†…éƒ¨å®ç°çš„æ¸…ç†æœºåˆ¶å¤„ç†çš„ï¼Œç¡®ä¿ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åä¸ä¼šæ®‹ç•™ä»»ä½•å‰¯æœ¬ï¼Œé¿å…å¯¹åç»­ä»»åŠ¡äº§ç”Ÿå½±å“ã€‚

ä½ æ— éœ€æ‰‹åŠ¨æ¸…ç†çº¿ç¨‹æ± ä¸­çš„å‰¯æœ¬ï¼Œ`TtlExecutor` ä¼šè‡ªåŠ¨å®Œæˆè¿™ä¸€å·¥ä½œã€‚

### 3. å¤šçº¿ç¨‹ä»»åŠ¡æäº¤æ—¶çš„å‰¯æœ¬ç®¡ç†

è€ƒè™‘åˆ°çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„å¤ç”¨ï¼Œå½“ `a` çº¿ç¨‹åˆšåˆšä¼ é€’å®Œ `TransmittableThreadLocal` çš„å‰¯æœ¬åï¼Œ`b` çº¿ç¨‹å†æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œ`b` çº¿ç¨‹çš„ä»»åŠ¡åŒæ ·ä¼šç‹¬ç«‹æ•è·å’Œä¼ é€’ `TransmittableThreadLocal` å‰¯æœ¬åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ã€‚ç”±äº `TtlExecutor` çš„æœºåˆ¶ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æœ‰ç‹¬ç«‹çš„å‰¯æœ¬ä¼ é€’ï¼Œå› æ­¤åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå‰¯æœ¬ä¸ä¼šå‡ºç°é”™ä¹±çš„æƒ…å†µã€‚

### 4. çº¿ç¨‹æ± ä¸­çš„å‰¯æœ¬ä¸ä¼šé”™ä¹±çš„åŸå› 

`TransmittableThreadLocal` çš„è®¾è®¡è€ƒè™‘åˆ°äº†çº¿ç¨‹æ± ä¸­çº¿ç¨‹å¤ç”¨çš„æƒ…å†µï¼Œå®ƒé€šè¿‡ä»¥ä¸‹æœºåˆ¶ç¡®ä¿çº¿ç¨‹æ± ä¸­çš„å‰¯æœ¬ä¸ä¼šé”™ä¹±ï¼š

- **ä»»åŠ¡éš”ç¦»**ï¼šæ¯ä¸ªä»»åŠ¡éƒ½æœ‰è‡ªå·±çš„ `TransmittableThreadLocal` å‰¯æœ¬ã€‚è¿™äº›å‰¯æœ¬åœ¨ä»»åŠ¡æäº¤æ—¶è¢«æ•è·å¹¶ä¸ä»»åŠ¡ç»‘å®šï¼Œå› æ­¤ä¸åŒä»»åŠ¡ä¹‹é—´çš„ä¸Šä¸‹æ–‡æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚
  
- **ä»»åŠ¡æ¸…ç†**ï¼šä»»åŠ¡æ‰§è¡Œç»“æŸæ—¶ï¼Œ`TtlExecutor` ä¼šè‡ªåŠ¨æ¸…ç†çº¿ç¨‹ä¸­çš„å‰¯æœ¬ï¼Œç¡®ä¿ä¸ä¼šæ±¡æŸ“åç»­çš„ä»»åŠ¡ã€‚

- **çº¿ç¨‹å®‰å…¨**ï¼š`TransmittableThreadLocal` çš„å®ç°æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œèƒ½å¤Ÿæ­£ç¡®å¤„ç†å¹¶å‘ä»»åŠ¡çš„ä¸Šä¸‹æ–‡ä¼ é€’å’Œæ¸…ç†å·¥ä½œã€‚

### æ€»ç»“

- **è‡ªåŠ¨ä¼ é€’**ï¼š`TransmittableThreadLocal` èƒ½å¤Ÿè‡ªåŠ¨ä¼ é€’å½“å‰çº¿ç¨‹çš„å‰¯æœ¬å€¼åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œç¡®ä¿åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶ä¸Šä¸‹æ–‡æ­£ç¡®ã€‚
  
- **è‡ªåŠ¨æ¸…ç†**ï¼šä½ æ— éœ€æ‰‹åŠ¨æ¸…ç†çº¿ç¨‹æ± ä¸­çš„å‰¯æœ¬ï¼Œ`TtlExecutor` ä¼šè‡ªåŠ¨å¤„ç†ä»»åŠ¡ç»“æŸåçš„å‰¯æœ¬æ¸…ç†ã€‚

- **ä»»åŠ¡éš”ç¦»**ï¼šä¸åŒä»»åŠ¡ä¹‹é—´çš„å‰¯æœ¬æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸ä¼šå‡ºç°é”™ä¹±çš„æƒ…å†µã€‚å³ä½¿æ˜¯å¤šçº¿ç¨‹æäº¤ä»»åŠ¡ï¼Œ`TransmittableThreadLocal` ä¹Ÿèƒ½æ­£ç¡®å¤„ç†ã€‚

å› æ­¤ï¼Œå½“ä½¿ç”¨ `TransmittableThreadLocal` å’Œ `TtlExecutor` æ—¶ï¼Œä½ å¯ä»¥æ”¾å¿ƒåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¼ é€’ä¸Šä¸‹æ–‡ï¼Œè€Œä¸å¿…æ‹…å¿ƒå‰¯æœ¬é”™ä¹±æˆ–æ®‹ç•™çš„é—®é¢˜ã€‚

# 10. ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»çº¿ç¨‹çš„å‰¯æœ¬åœ¨æäº¤ç»™çº¿ç¨‹æ± ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œå‰¯æœ¬ä¼šè¢«å¤åˆ¶åˆ°ä»»åŠ¡å¯¹è±¡ğŸ€„ï¸ï¼Œå½“ä»»åŠ¡æ˜ç¡®äº†ç”±å“ªä¸ªæ± ä¸­çš„çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œä¼šå†æ¬¡è¢«å¤åˆ¶åˆ°å·¥ä½œçº¿ç¨‹ä¸­å»ï¼Ÿè¿˜æœ‰ï¼Œè¦ç¡®ä¿è¿™ä¸ªæœºåˆ¶ï¼Œæ˜¯å¦æ„å‘³ç€å¿…é¡»ä½¿ç”¨ttlExecutorè€Œä¸èƒ½ä½¿ç”¨å…¶ä»–çš„éƒ½çº¿ç¨‹æ± å¯¹è±¡ï¼Ÿ
æ˜¯çš„ï¼Œ`TransmittableThreadLocal` çš„å·¥ä½œæœºåˆ¶å¯ä»¥ç®€è¦æ€»ç»“å¦‚ä¸‹ï¼š

1. **ä¸»çº¿ç¨‹å‰¯æœ¬æ•è·**ï¼šå½“ä½ åœ¨ä¸»çº¿ç¨‹ä¸­è®¾ç½®äº† `TransmittableThreadLocal` çš„å€¼å¹¶æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± æ—¶ï¼ˆä¾‹å¦‚é€šè¿‡ `submit` æˆ– `execute`ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œ`TtlExecutor` ä¼šæ•è·ä¸»çº¿ç¨‹ä¸­çš„ `TransmittableThreadLocal` å‰¯æœ¬å€¼ï¼Œå¹¶å°†è¿™äº›å€¼ä¸ä»»åŠ¡å¯¹è±¡ç»‘å®šã€‚

2. **ä»»åŠ¡æ‰§è¡Œæ—¶çš„å‰¯æœ¬ä¼ é€’**ï¼šå½“çº¿ç¨‹æ± ä¸­æŸä¸ªå·¥ä½œçº¿ç¨‹å¼€å§‹æ‰§è¡Œè¿™ä¸ªä»»åŠ¡æ—¶ï¼Œä»»åŠ¡å¯¹è±¡ä¸­ç»‘å®šçš„ `TransmittableThreadLocal` å‰¯æœ¬å€¼ä¼šè¢«å¤åˆ¶åˆ°è¿™ä¸ªå·¥ä½œçº¿ç¨‹ä¸­ï¼Œä½¿å¾—è¯¥å·¥ä½œçº¿ç¨‹å¯ä»¥æ­£ç¡®åœ°è·å–å’Œä½¿ç”¨è¿™äº›å‰¯æœ¬å€¼ã€‚

3. **ä»»åŠ¡æ‰§è¡Œåçš„å‰¯æœ¬æ¸…ç†**ï¼šä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œ`TtlExecutor` ä¼šè‡ªåŠ¨æ¸…ç†å·¥ä½œçº¿ç¨‹ä¸­çš„ `TransmittableThreadLocal` å‰¯æœ¬ï¼Œé˜²æ­¢å½±å“åç»­ä»»åŠ¡ã€‚

### å¿…é¡»ä½¿ç”¨ `TtlExecutor` çš„åŸå› 

`TtlExecutor` æ˜¯ `TransmittableThreadLocal` æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œç”¨äºç¡®ä¿ `TransmittableThreadLocal` çš„å€¼èƒ½å¤Ÿåœ¨çº¿ç¨‹æ± ä¸­æ­£ç¡®ä¼ é€’ã€‚å¦‚æœä½ ç›´æ¥ä½¿ç”¨æ™®é€šçš„çº¿ç¨‹æ± ï¼ˆå¦‚ `Executors.newFixedThreadPool`ï¼‰ï¼Œç”±äºçº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹çš„ç‰¹æ€§ï¼Œ`ThreadLocal` æˆ– `TransmittableThreadLocal` çš„å€¼ä¸ä¼šè‡ªåŠ¨åœ¨ä»»åŠ¡ä¹‹é—´æ­£ç¡®ä¼ é€’ã€‚

**ç®€è€Œè¨€ä¹‹ï¼š**

- **`TtlExecutor` æ•è·å’Œä¼ é€’æœºåˆ¶**ï¼šæ™®é€šçš„çº¿ç¨‹æ± å¹¶æ²¡æœ‰æœºåˆ¶æ¥æ•è·ä¸»çº¿ç¨‹çš„ `ThreadLocal` å‰¯æœ¬å¹¶ä¼ é€’ç»™å·¥ä½œçº¿ç¨‹ã€‚è€Œ `TtlExecutor` ä¸“é—¨å°è£…äº†è¿™ç§æ•è·å’Œä¼ é€’æœºåˆ¶ï¼Œä»è€Œç¡®ä¿ä»»åŠ¡æ‰§è¡Œæ—¶ä¸Šä¸‹æ–‡çš„ä¸€è‡´æ€§ã€‚

- **è‡ªåŠ¨æ¸…ç†**ï¼š`TtlExecutor` è¿˜å¤„ç†äº†å‰¯æœ¬çš„è‡ªåŠ¨æ¸…ç†å·¥ä½œï¼Œé˜²æ­¢çº¿ç¨‹å¤ç”¨å¸¦æ¥çš„å‰¯æœ¬æ®‹ç•™é—®é¢˜ã€‚

### æ€»ç»“

- **å‰¯æœ¬ä¼ é€’**ï¼š`TtlExecutor` ç¡®ä¿ `TransmittableThreadLocal` çš„å‰¯æœ¬å€¼åœ¨ä»»åŠ¡æäº¤æ—¶è¢«æ­£ç¡®æ•è·ï¼Œå¹¶åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶è¢«ä¼ é€’åˆ°çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ã€‚
- **å¿…é¡»ä½¿ç”¨ `TtlExecutor`**ï¼šä¸ºäº†ç¡®ä¿ `TransmittableThreadLocal` çš„æ­£ç¡®ä½¿ç”¨å’Œå‰¯æœ¬çš„ä¼ é€’ã€æ¸…ç†ï¼Œä½ å¿…é¡»ä½¿ç”¨ `TtlExecutor`ï¼Œè€Œä¸èƒ½ç›´æ¥ä½¿ç”¨æ™®é€šçš„çº¿ç¨‹æ± å¯¹è±¡ã€‚

å¦‚æœä½ å¸Œæœ› `TransmittableThreadLocal` èƒ½å¤Ÿåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æ­£ç¡®å·¥ä½œï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼ŒåŠ¡å¿…é€šè¿‡ `TtlExecutor` è¿›è¡Œå°è£…ã€‚
